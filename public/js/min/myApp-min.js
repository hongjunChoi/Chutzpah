var app=angular.module("myApp",["ngRoute","ngResource"]).run(function(e,t){e.authenticated=!1,e.current_user="",t.get("/auth/session").success(function(t){t&&"undefined"!==t&&t.user&&(e.authenticated=!0,e.current_user=t.user.username)}),e.signout=function(){t.get("auth/signout"),e.authenticated=!1,e.current_user=""}});app.config(function(e){e.when("/login",{templateUrl:"login.html",controller:"authController"}).when("/signup",{templateUrl:"register.html",controller:"authController"})}),app.directive("fileModel",["$parse",function(e){return{restrict:"A",link:function(t,s,n){var r=e(n.fileModel),o=r.assign;s.bind("change",function(){t.$apply(function(){o(t,s[0].files[0])})})}}}]),app.service("fileUpload",["$http",function(e){this.uploadFileToUrl=function(t,s){var n=new FormData;n.append("file",t),e.post(s,n,{transformRequest:angular.identity,headers:{"Content-Type":void 0}}).success(function(){}).error(function(){})}}]),app.controller("searchController",function(e,t,s){e.search_results={},e.search=function(){s.get("/api/search",{params:{search_string:e.search_string}}).success(function(t){e.search_results=t})}}),app.factory("postService",function(e){return e("/api/posts/:id")}),app.controller("mainController",function(e,t,s,n,r,o){s.posts=e.query(),console.log(e.query()),s.newPost={created_by:"",text:"",created_at:""},s.user_posts={},s.trustSrc=function(e){return r.trustAsResourceUrl(e)},s.post=function(){s.newPost.created_by=n.current_user,s.newPost.created_at=Date.now(),e.save(s.newPost,function(){s.posts=e.query(),s.newPost={created_by:"",text:"",created_at:""}})},s.upload=function(){var e=s.myFile;console.log("file is "),console.dir(e);var n="/api/upload_file";t.uploadFileToUrl(e,n),alert(n)},s.upload_comment=function(){var e="/api/comment";s.comment.created_by=n.current_user,s.comment.post_id=1,o.post(e,{comment:s.comment}).success(function(e){"success"==e.state||(s.error_message=e.message)})},s.load_comments=function(){var e="/api/comment";s.post_id=1,o.get(e,{post_id:s.post_id}).success(function(e){"success"==e.state||(s.error_message=e.message)})}}),app.controller("profileController",function(e,t,s){e.user_posts=[],e.get_profile_info=function(){var n="/api/profile",r=t.current_user;s.get(n,{params:{username:r}}).success(function(t){var s=t.info,n=t.posts;e.user_posts=n,$("body").addClass("profileopened"),console.log(e.user_posts),n.forEach(function(e){$("#user_post_wrapper").append("<li>"+e+"</li>")})})},e.get_chat=function(){s.get("/get_chat",{params:{user_name:t.current_user}}).success(function(e){alert("get chat success"),console.log("get chat results"),console.log(e)})},e.send_chat=function(){var e="/send_chat",n="scottljy";alert("sent chat front end"),s.post(e,{sent_from:t.current_user,text:"abcd",sent_to:n}).success(function(e){alert("send chat success"),console.log("send chat result "),console.log(e)})}}),app.controller("authController",function(e,t,s,n){e.user={username:"",password:"",location:"",bandname:"",genre:"",user_type:""},e.error_message="",e.login=function(){t.post("/auth/login",e.user).success(function(t){"success"==t.state?(s.authenticated=!0,s.current_user=t.user.username,n.path("/profile")):e.error_message=t.message})},e.register=function(){$("#register_musician_tab").hasClass("active")?e.user.user_type="musician":e.user.user_type="host",t.post("/auth/signup",e.user).success(function(t){"success"==t.state?(s.authenticated=!0,s.current_user=t.user.username,n.path("/")):e.error_message=t.message})}});