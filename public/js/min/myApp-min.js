function set_user_profile(e){var t=e.username,s=e.user_location,n=e.user_description,r=e.genre;$("#user_profile_username").html(t),$("#user_profile_location").html(s),$("#user_profile_description").html(n),$("#user_profile_genre").html(r),$("#contact_to").html(t)}var app=angular.module("myApp",["ngRoute","ngResource"]).run(function(e,t){e.authenticated=!1,e.current_user="",e.now_playing="",t.get("/auth/session").success(function(t){t&&"undefined"!==t&&t.user&&(e.authenticated=!0,e.current_user=t.user.username,e.now_playing={created_by:e.current_user})}),e.signout=function(){t.get("auth/signout"),e.authenticated=!1,e.current_user=""}});app.config(function(e){e.when("/login",{templateUrl:"login.html",controller:"authController"}).when("/signup",{templateUrl:"register.html",controller:"authController"})}),app.directive("fileModel",["$parse",function(e){return{restrict:"A",link:function(t,s,n){var r=e(n.fileModel),o=r.assign;s.bind("change",function(){t.$apply(function(){o(t,s[0].files[0])})})}}}]),app.service("fileUpload",["$http",function(e){this.uploadFileToUrl=function(t,s){var n=new FormData;n.append("file",t),e.post(s,n,{transformRequest:angular.identity,headers:{"Content-Type":void 0}}).success(function(){}).error(function(){})}}]),app.controller("searchController",function(e,t,s){e.search_results={},e.search=function(){s.get("/api/search",{params:{search_string:e.search_string}}).success(function(t){e.search_results=t})}}),app.factory("postService",function(e){return e("/api/posts/:id")}),app.controller("mainController",function(e,t,s,n,r,o){s.posts=[],s.files=[];var a=e.query(),c=[],i=[];a.$promise.then(function(e){for(var t=0;t<e.length;t++){var n=e[t];1==n.is_file||"true"==n.is_file?c.push(n):i.push(n)}s.posts=i,s.files=c}),s.newPost={created_by:"",text:"",created_at:""},s.user_posts={},s.trustSrc=function(e){return r.trustAsResourceUrl(e)},s.post=function(){alert("post"),s.newPost.created_by=n.current_user,s.newPost.created_at=Date.now(),e.save(s.newPost,function(){s.posts=e.query(),s.newPost={created_by:"",text:"",created_at:""}})},s.get_now_playing=function(){alert(n.now_playing)},s.upload=function(){alert("upload file");var e=s.myFile;console.log("file is "),console.dir(e);var n="/api/upload_file";t.uploadFileToUrl(e,n),alert(n)},s.upload_comment=function(){alert("comment");var e="/api/comment";alert("uploading"),s.comment.created_by=n.current_user,s.comment.post_id=s.post_id,o.post(e,{comment:s.comment}).success(function(e){"success"==e.state||(s.error_message=e.message)})},s.load_comments=function(e){var t="/api/comment";s.post_id=e,o.get(t,{params:{post_id:e}}).success(function(e){return console.log(e),$(".commentlist").empty(),e.forEach(function(e){$(".commentlist").append("<li>"+e.created_by+" said: "+e.text+" at : "+e.created_at+"</li>")}),$(".commentField").show(),e})},s.start_music=function(e){console.log("starting music"),$("#jquery_jplayer_1").jPlayer("setMedia",{title:e.original_name,mp3:e.url.substring(e.url.indexOf("/")+1)}),s.post_id=e._id,data=s.load_comments(e._id),n.now_playing=e,console.log("=========="),console.log(n.now_playing),data=s.load_comments(e._id),data.forEach(function(e){console.log(e)}),console.log(data)}}),app.controller("profileController",function(e,t,s){e.user_posts=[],e.user_info={},e.get_profile_info=function(){var n="/api/profile",r=t.now_playing.created_by;s.get(n,{params:{username:r}}).success(function(t){var s=t.info;console.log("==========user INFO======="),console.log(s),set_user_profile(s[0]);var n=t.posts;e.user_info=s,e.user_posts=n,$("body").addClass("profileopened"),console.log(e.user_posts),n.forEach(function(e){var t="<li style = 'display:block'><h6>"+e.text+" </h6> <p>"+e.created_at+"</p> <p>"+e.created_by+"</p></li>";$("#user_post_wrapper").append(t)})})},e.confirm_request=function(e){console.log("confirming & posting request");var t="/api/event";s.post(t,{artist:"ARTIST",venue:"VENUE"}).success(function(e){alert("success"+e)})},e.get_chat=function(){alert("get chat request"),s.get("/get_chat",{params:{user_name:t.current_user}}).success(function(e){alert("get chat success"),console.log("get chat results"),console.log(e);for(var t={},s=0;s<e.length;s++){var n=e[s],r=n.sent_from;if(r in t)t[r].push(n);else{var o=[];o.push(n),t[r]=o}}for(var a=Object.keys(t),s=0;s<a.length;s++){var c=a[s],i="chat_"+c,n="<li id = "+i+">"+c+"</li>";$("#chat_list").append(n),$("#"+i).data("chats",t[c])}})},e.send_chat=function(){var e="/send_chat",n="scottljy";alert("sent chat front end"),s.post(e,{sent_from:t.current_user,text:"abcd",sent_to:n}).success(function(e){alert("send chat success"),console.log("send chat result "),console.log(e)})}}),app.controller("authController",function(e,t,s,n){e.user={username:"",password:"",location:"",bandname:"",genre:"",user_type:""},e.error_message="",e.login=function(){t.post("/auth/login",e.user).success(function(t){"success"==t.state?(s.authenticated=!0,s.current_user=t.user.username,n.path("/profile")):e.error_message=t.message})},e.register=function(){$("#register_musician_tab").hasClass("active")?e.user.user_type="musician":e.user.user_type="host",t.post("/auth/signup",e.user).success(function(t){"success"==t.state?(s.authenticated=!0,s.current_user=t.user.username,n.path("/")):e.error_message=t.message})}});